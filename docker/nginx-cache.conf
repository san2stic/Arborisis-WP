# Nginx caching configuration for static assets and API responses

# Cache paths
proxy_cache_path /var/cache/nginx/static levels=1:2 keys_zone=static_cache:10m max_size=1g inactive=60m use_temp_path=off;
proxy_cache_path /var/cache/nginx/api levels=1:2 keys_zone=api_cache:10m max_size=500m inactive=10m use_temp_path=off;

# Cache key
proxy_cache_key "$scheme$request_method$host$request_uri";

# Static assets caching
location ~* \.(jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot|css|js)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
    
    # Enable gzip
    gzip_static on;
}

# API response caching
location /wp-json/ {
    proxy_cache api_cache;
    proxy_cache_valid 200 5m;
    proxy_cache_valid 404 1m;
    proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
    proxy_cache_background_update on;
    proxy_cache_lock on;
   
    add_header X-Cache-Status $upstream_cache_status;
    
    # Pass to PHP-FPM
    include fastcgi_params;
    fastcgi_pass wordpress:9000;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
}

# WordPress core files caching
location ~ ^/wp-(content|includes)/ {
    expires 1y;
    add_header Cache-Control "public";
}

# Browser caching headers
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
